{
  "description": "Sample Elasticsearch queries used by the Smart Travel Expense Analyzer agent",
  "queries": [
    {
      "name": "Budget Prediction - Osaka (Aggregations)",
      "description": "Compute total_hkd and unique_days for location=大阪, then derive daily average and predicted budget.",
      "use_case": "When user asks: 'How much budget do I need for Osaka for 5 days?'",
      "request": {
        "index": "travel_database",
        "size": 0,
        "query": {
          "term": {
            "location": "大阪"
          }
        },
        "aggs": {
          "total_hkd": {
            "sum": {
              "field": "amount_hkd"
            }
          },
          "unique_days": {
            "cardinality": {
              "field": "date"
            }
          }
        }
      },
      "expected_results": {
        "total_hkd": {
          "value": 10320
        },
        "unique_days": {
          "value": 14
        }
      },
      "calculation": {
        "daily_average": "10320 / 14 = 737 HKD/day",
        "predicted_5_days": "737 * 5 = 3685 HKD"
      }
    },
    {
      "name": "Budget Prediction - Fukuoka (Aggregations)",
      "description": "Compute total_hkd and unique_days for location=福岡",
      "use_case": "When user asks: 'How much budget do I need for Fukuoka for 4 days?'",
      "request": {
        "index": "travel_database",
        "size": 0,
        "query": {
          "term": {
            "location": "福岡"
          }
        },
        "aggs": {
          "total_hkd": {
            "sum": {
              "field": "amount_hkd"
            }
          },
          "unique_days": {
            "cardinality": {
              "field": "date"
            }
          }
        }
      },
      "expected_results": {
        "total_hkd": {
          "value": 1716
        },
        "unique_days": {
          "value": 3
        }
      },
      "calculation": {
        "daily_average": "1716 / 3 = 572 HKD/day",
        "predicted_4_days": "572 * 4 = 2288 HKD"
      }
    },
    {
      "name": "Budget Prediction - Tokyo (Aggregations)",
      "description": "Compute total_hkd and unique_days for location=東京",
      "use_case": "When user asks: 'How much budget do I need for Tokyo for 7 days?'",
      "request": {
        "index": "travel_database",
        "size": 0,
        "query": {
          "term": {
            "location": "東京"
          }
        },
        "aggs": {
          "total_hkd": {
            "sum": {
              "field": "amount_hkd"
            }
          },
          "unique_days": {
            "cardinality": {
              "field": "date"
            }
          }
        }
      },
      "expected_results": {
        "total_hkd": {
          "value": 10710
        },
        "unique_days": {
          "value": 11
        }
      },
      "calculation": {
        "daily_average": "10710 / 11 = 974 HKD/day",
        "predicted_7_days": "974 * 7 = 6818 HKD"
      }
    },
    {
      "name": "Budget Prediction - Taichung (Aggregations)",
      "description": "Compute total_hkd and unique_days for location=台中",
      "use_case": "When user asks: 'How much budget do I need for Taichung for 3 days?'",
      "request": {
        "index": "travel_database",
        "size": 0,
        "query": {
          "term": {
            "location": "台中"
          }
        },
        "aggs": {
          "total_hkd": {
            "sum": {
              "field": "amount_hkd"
            }
          },
          "unique_days": {
            "cardinality": {
              "field": "date"
            }
          }
        }
      },
      "expected_results": {
        "total_hkd": {
          "value": 2555
        },
        "unique_days": {
          "value": 4
        }
      },
      "calculation": {
        "daily_average": "2555 / 4 = 638 HKD/day",
        "predicted_3_days": "638 * 3 = 1914 HKD"
      }
    },
    {
      "name": "Category Breakdown - Osaka (Optional)",
      "description": "Compute category breakdown for location=大阪 when explicitly requested by user",
      "use_case": "When user asks: '去大阪5天，各類別分別需要多少預算？'",
      "request": {
        "index": "travel_database",
        "size": 0,
        "query": {
          "term": {
            "location": "大阪"
          }
        },
        "aggs": {
          "total_hkd": {
            "sum": {
              "field": "amount_hkd"
            }
          },
          "unique_days": {
            "cardinality": {
              "field": "date"
            }
          },
          "by_category": {
            "terms": {
              "field": "category",
              "size": 10
            },
            "aggs": {
              "cat_sum": {
                "sum": {
                  "field": "amount_hkd"
                }
              }
            }
          }
        }
      },
      "expected_results": {
        "total_hkd": {
          "value": 10320
        },
        "unique_days": {
          "value": 14
        },
        "by_category": {
          "buckets": [
            {
              "key": "購物",
              "cat_sum": {
                "value": 4200
              }
            },
            {
              "key": "住宿",
              "cat_sum": {
                "value": 3060
              }
            },
            {
              "key": "交通",
              "cat_sum": {
                "value": 1512
              }
            },
            {
              "key": "景點",
              "cat_sum": {
                "value": 912
              }
            },
            {
              "key": "餐飲",
              "cat_sum": {
                "value": 636
              }
            }
          ]
        }
      },
      "calculation": {
        "daily_average_total": "10320 / 14 = 737 HKD/day",
        "shopping_5_days": "(4200 / 14) * 5 = 1500 HKD",
        "accommodation_5_days": "(3060 / 14) * 5 = 1093 HKD",
        "transportation_5_days": "(1512 / 14) * 5 = 540 HKD",
        "attractions_5_days": "(912 / 14) * 5 = 326 HKD",
        "dining_5_days": "(636 / 14) * 5 = 227 HKD"
      }
    },
    {
      "name": "City Comparison - All Locations",
      "description": "Compare daily average costs across all cities",
      "use_case": "When user asks: '哪個城市最貴？' or 'Which city is most expensive?'",
      "request": {
        "index": "travel_database",
        "size": 0,
        "aggs": {
          "by_location": {
            "terms": {
              "field": "location",
              "size": 10
            },
            "aggs": {
              "total_hkd": {
                "sum": {
                  "field": "amount_hkd"
                }
              },
              "unique_days": {
                "cardinality": {
                  "field": "date"
                }
              },
              "daily_average": {
                "bucket_script": {
                  "buckets_path": {
                    "total": "total_hkd",
                    "days": "unique_days"
                  },
                  "script": "params.total / params.days"
                }
              }
            }
          }
        }
      },
      "expected_results": {
        "by_location": {
          "buckets": [
            {
              "key": "東京",
              "total_hkd": 10710,
              "unique_days": 11,
              "daily_average": 974
            },
            {
              "key": "台中",
              "total_hkd": 2555,
              "unique_days": 4,
              "daily_average": 638
            },
            {
              "key": "大阪",
              "total_hkd": 10320,
              "unique_days": 14,
              "daily_average": 737
            },
            {
              "key": "福岡",
              "total_hkd": 1716,
              "unique_days": 3,
              "daily_average": 572
            }
          ]
        }
      }
    },
    {
      "name": "Overview Analysis - 2024 Total Spending",
      "description": "Calculate total spending for year 2024",
      "use_case": "When user asks: 'How much did I spend on travel in 2024?'",
      "request": {
        "index": "travel_database",
        "size": 0,
        "query": {
          "range": {
            "date": {
              "gte": "2024-01-01",
              "lt": "2025-01-01"
            }
          }
        },
        "aggs": {
          "total_hkd": {
            "sum": {
              "field": "amount_hkd"
            }
          }
        }
      },
      "expected_results": {
        "total_hkd": {
          "value": 20591
        }
      }
    },
    {
      "name": "Guardrail Test - No Data City",
      "description": "Query for a city with no data (should return empty results)",
      "use_case": "When user asks: 'How much budget for Kyoto?' (city not in database)",
      "request": {
        "index": "travel_database",
        "size": 0,
        "query": {
          "term": {
            "location": "京都"
          }
        },
        "aggs": {
          "total_hkd": {
            "sum": {
              "field": "amount_hkd"
            }
          },
          "unique_days": {
            "cardinality": {
              "field": "date"
            }
          }
        }
      },
      "expected_results": {
        "total_hkd": {
          "value": 0
        },
        "unique_days": {
          "value": 0
        }
      },
      "expected_agent_response": "目前資料庫中沒有京都（Kyoto）的旅行記錄，無法提供預算預測。"
    }
  ],
  "notes": {
    "important_reminders": [
      "Always use 'amount_hkd' field for calculations, never 'amount'",
      "Always use Chinese values in term queries (東京 not Tokyo)",
      "Use cardinality(date) for counting unique days, not doc_count",
      "Daily average formula: sum(amount_hkd) / cardinality(date)",
      "Verify calculations: daily_average * unique_days ≈ total_hkd"
    ]
  }
}
